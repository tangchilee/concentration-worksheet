<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¼å…’å°ˆæ³¨åŠ›å­¸ç¿’å–® - å°ˆæ¥­å¼·åŒ–ç‰ˆ</title>
    <!-- è¼‰å…¥ Noto Serif TC å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ React æ ¸å¿ƒ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- è¼‰å…¥ Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- è¼‰å…¥ html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        * { font-family: 'Noto Serif TC', serif !important; }
        body { background-color: #fff7ed; -webkit-tap-highlight-color: transparent; }
        @media print { .no-print { display: none !important; } }
        button { outline: none; }
        .fade-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- SVG åœ–æ¨™å…ƒä»¶ ---
        const IconWrapper = ({ children, color, className }) => (
            <svg viewBox="0 0 24 24" className={className} fill="currentColor" style={{ color }}>{children}</svg>
        );

        const Icons = {
            Triangle: (p) => <IconWrapper {...p}><path d="M12 2L22 21H2L12 2Z"/></IconWrapper>,
            Square: (p) => <IconWrapper {...p}><rect x="3" y="3" width="18" height="18" rx="1"/></IconWrapper>,
            Hexagon: (p) => <IconWrapper {...p}><path d="M12 2l8.66 5v10L12 22l-8.66-5V7L12 2z"/></IconWrapper>,
            Circle: (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/></IconWrapper>,
            Diamond: (p) => <IconWrapper {...p}><path d="M12 2l9 10-9 10-9-10 9-10z"/></IconWrapper>,
            Pentagon: (p) => <IconWrapper {...p}><path d="M12 2l9 6.5L17.5 19h-11L3 8.5z"/></IconWrapper>,
            Cross: (p) => <IconWrapper {...p}><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></IconWrapper>,
            Arrow: (p) => <IconWrapper {...p}><path d="M12 2L22 12L12 22V17H2V7H12V2Z"/></IconWrapper>,
            Lightning: (p) => <IconWrapper {...p}><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></IconWrapper>,
            Shield: (p) => <IconWrapper {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></IconWrapper>,
            Star: (p) => <IconWrapper {...p}><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></IconWrapper>,
            Moon: (p) => <IconWrapper {...p}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></IconWrapper>,
            Sun: (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="5"/><path stroke="currentColor" strokeWidth="2" d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></IconWrapper>,
            Cloud: (p) => <IconWrapper {...p}><path d="M17.5 19c2.5 0 4.5-2 4.5-4.5 0-2.4-1.8-4.3-4.2-4.5a7 7 0 1 0-13.3 2c-1.5.3-2.5 1.5-2.5 3 0 1.7 1.3 3 3 3h12.5z"/></IconWrapper>,
            Heart: (p) => <IconWrapper {...p}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></IconWrapper>,
            Key: (p) => <IconWrapper {...p}><path stroke="currentColor" strokeWidth="2" d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.78 7.78 5.5 5.5 0 0 1 7.78-7.78zM15 8l2 2m-5 5l7-7"/></IconWrapper>,
            Palette: (p) => <IconWrapper {...p}><path stroke="currentColor" strokeWidth="2" d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.9 0 1.6-.7 1.6-1.6 0-.4-.2-.8-.5-1.1-.3-.3-.5-.7-.5-1.2 0-.9.7-1.6 1.6-1.6H16c3.3 0 6-2.7 6-6 0-4.4-4.5-8-10-8z"/></IconWrapper>,
            Hash: (p) => <IconWrapper {...p}><path stroke="currentColor" strokeWidth="2" d="M4 9h16M4 15h16M10 3L8 21M16 3l-2 18"/></IconWrapper>,
            ImageIcon: (p) => <IconWrapper {...p}><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path stroke="currentColor" strokeWidth="2" d="M21 15l-5-5L5 21"/></IconWrapper>,
            RotateCcw: (p) => <IconWrapper {...p}><path stroke="currentColor" strokeWidth="2" d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path stroke="currentColor" strokeWidth="2" d="M3 3v5h5"/></IconWrapper>,
            Sparkles: (p) => <IconWrapper {...p}><path stroke="currentColor" strokeWidth="2" d="M12 3l1.91 5.82L21 12l-7.09 3.18L12 21l-1.91-5.82L3 12l7.09-3.18L12 3z"/></IconWrapper>,
            RefreshCw: (p) => <IconWrapper {...p}><path stroke="currentColor" strokeWidth="2" d="M21 2v6h-6"/><path stroke="currentColor" strokeWidth="2" d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path stroke="currentColor" strokeWidth="2" d="M3 22v-6h6"/><path stroke="currentColor" strokeWidth="2" d="M21 12a9 9 0 0 1-15 6.7L3 16"/></IconWrapper>
        };

        const App = () => {
            const [mode, setMode] = useState('3x3');
            const [isRandom, setIsRandom] = useState(true);
            const [leftGrid, setLeftGrid] = useState([]);
            const [rightGrid, setRightGrid] = useState([]);
            const [targetIcons, setTargetIcons] = useState([]);
            const [userAnswers, setUserAnswers] = useState({});
            const [activePickerId, setActivePickerId] = useState(null);
            const [isExporting, setIsExporting] = useState(false);
            const [checkResult, setCheckResult] = useState(null);
            const exportContainerRef = useRef(null);
            const pickerRef = useRef(null);

            const themeColors = { orange: '#ff8c42', amber: '#f59e0b', caramel: '#d35400', deepCocoa: '#433422', cardBg: '#fff9e6' };

            const iconPool = [
                { id: 'triangle', component: Icons.Triangle, hex: themeColors.orange },
                { id: 'square', component: Icons.Square, hex: themeColors.amber },
                { id: 'hexagon', component: Icons.Hexagon, hex: themeColors.caramel },
                { id: 'circle', component: Icons.Circle, hex: themeColors.orange },
                { id: 'diamond', component: Icons.Diamond, hex: themeColors.amber },
                { id: 'pentagon', component: Icons.Pentagon, hex: themeColors.caramel },
                { id: 'cross', component: Icons.Cross, hex: themeColors.orange },
                { id: 'arrow', component: Icons.Arrow, hex: themeColors.amber },
                { id: 'lightning', component: Icons.Lightning, hex: themeColors.caramel },
                { id: 'shield', component: Icons.Shield, hex: themeColors.orange },
                { id: 'star', component: Icons.Star, hex: themeColors.amber },
                { id: 'moon', component: Icons.Moon, hex: themeColors.caramel },
                { id: 'sun', component: Icons.Sun, hex: themeColors.orange },
                { id: 'cloud', component: Icons.Cloud, hex: themeColors.amber },
                { id: 'heart', component: Icons.Heart, hex: themeColors.caramel }
            ];

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (activePickerId && pickerRef.current && !pickerRef.current.contains(event.target)) {
                        if (!event.target.closest('.answer-button-cell')) {
                            setActivePickerId(null);
                        }
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [activePickerId]);

            const generateNewGame = () => {
                const is3x3 = mode === '3x3';
                const gridSize = is3x3 ? 9 : 16;
                const side = is3x3 ? 3 : 4;
                const targetCount = is3x3 ? 5 : 8;
                const shuffledIcons = [...iconPool].sort(() => 0.5 - Math.random()).slice(0, targetCount);
                setTargetIcons(shuffledIcons);

                let leftPositions;
                let attempts = 0;
                while (attempts < 20) {
                    leftPositions = Array(gridSize).fill(null);
                    const indices = Array.from({length: gridSize}, (_, i) => i).sort(() => 0.5 - Math.random());
                    const chosen = indices.slice(0, targetCount);
                    const rowCounts = Array(side).fill(0);
                    const colCounts = Array(side).fill(0);
                    chosen.forEach(idx => {
                        rowCounts[Math.floor(idx / side)]++;
                        colCounts[idx % side]++;
                    });
                    if (!rowCounts.some(c => c > (is3x3 ? 2 : 3)) && !colCounts.some(c => c > (is3x3 ? 2 : 3)) || attempts === 19) {
                        chosen.forEach((idx, i) => { leftPositions[idx] = shuffledIcons[i]; });
                        break;
                    }
                    attempts++;
                }
                setLeftGrid(leftPositions);
                let rightNumbers = Array.from({length: gridSize}, (_, i) => i + 1);
                if (isRandom) rightNumbers.sort(() => 0.5 - Math.random());
                setRightGrid(rightNumbers);
                setUserAnswers({});
                setActivePickerId(null);
                setCheckResult(null);
            };

            useEffect(() => { generateNewGame(); }, [mode, isRandom]);

            const handleExportImage = async () => {
                if (isExporting) return;
                setIsExporting(true);
                const exportArea = exportContainerRef.current;
                exportArea.style.display = 'block';
                try {
                    const canvas = await html2canvas(exportArea, { scale: 3, useCORS: true, backgroundColor: '#ffffff', width: 800, height: 1132 });
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL("image/png", 1.0);
                    link.download = `å¹¼å…’å°ˆæ³¨åŠ›ç·´ç¿’å–®_${mode}.png`;
                    link.click();
                } catch (err) { console.error(err); }
                finally { exportArea.style.display = 'none'; setIsExporting(false); }
            };

            const checkAnswers = () => {
                let allCorrect = true;
                let answeredAll = true;
                targetIcons.forEach(icon => {
                    const posIndex = leftGrid.findIndex(item => item && item.id === icon.id);
                    const correctNumber = rightGrid[posIndex];
                    if (!userAnswers[icon.id]) answeredAll = false;
                    if (parseInt(userAnswers[icon.id]) !== correctNumber) allCorrect = false;
                });
                if (!answeredAll) setCheckResult({ success: false, text: 'é‚„æœ‰æ ¼å­æ²’å¡«å®Œå–”ï¼' });
                else if (allCorrect) setCheckResult({ success: true, text: 'å¤ªæ£’äº†ï¼å…¨éƒ¨éƒ½ç­”å°äº†ï¼' });
                else setCheckResult({ success: false, text: 'å“å‘€ï¼Œæœ‰äº›åœ°æ–¹å¡«éŒ¯äº†ï¼Œå†æ‰¾æ‰¾çœ‹å§ï¼' });
            };

            const labelBaseClass = "bg-[#ff8c42] text-white px-4 sm:px-8 py-2.5 sm:h-12 rounded-full font-black text-[10px] sm:text-lg tracking-widest shadow-md flex items-center justify-center gap-1.5 sm:gap-2 leading-none whitespace-nowrap";

            return (
                <div className="min-h-screen p-2 sm:p-4 md:p-8 selection:bg-orange-200 relative">
                    
                    {/* çµæœæç¤ºè¦–çª— (ä¸å½±éŸ¿æŒ‰éˆ•èˆ‡é é¢çµæ§‹) */}
                    {checkResult && (
                        <div className="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm no-print" onClick={() => setCheckResult(null)}>
                            <div className="bg-white rounded-[2rem] p-8 max-w-sm w-full shadow-2xl border-4 border-[#f9ebbe] text-center fade-in" onClick={e => e.stopPropagation()}>
                                <div className="text-6xl mb-4">{checkResult.success ? 'ğŸ‰' : 'ğŸ’¡'}</div>
                                <h2 className="text-2xl font-black text-orange-950 mb-6">{checkResult.text}</h2>
                                <button onClick={() => setCheckResult(null)} className="w-full py-3 bg-[#ff8c42] text-white rounded-xl font-black shadow-[0_4px_0_#d35400] active:translate-y-1">çŸ¥é“äº†</button>
                            </div>
                        </div>
                    )}

                    <div className="max-w-5xl mx-auto bg-white rounded-[2rem] shadow-xl overflow-hidden border-[6px] sm:border-[12px] border-[#f9ebbe] flex flex-col no-print pb-12">
                        <div className="text-center pt-8 pb-0 px-4">
                            <div className="inline-flex items-center gap-2 px-3 py-1 bg-orange-100 text-[#ff8c42] rounded-full text-xs font-black mb-3"><Icons.Sparkles className="w-3.5 h-3.5" /> æ•™å­¸è¼”åŠ©å·¥å…·</div>
                            <h1 className="text-3xl sm:text-5xl font-[900] text-orange-950 tracking-[0.15em] mb-3 leading-tight">å°ˆæ³¨åŠ›å­¸ç¿’å–®</h1>
                            <p className="text-[#433422]/80 font-normal text-[10px] sm:text-[14px] mb-4">ç‚ºå°æœ‹å‹æ‰“é€ æœ€æº«é¦¨ã€å°ˆæ¥­çš„è¦–è¦ºæœå°‹èˆ‡ç©ºé–“å°æ‡‰ç·´ç¿’ç©ºé–“</p>
                        </div>

                        <div className="p-3 sm:p-10 pt-4 flex-grow flex flex-col items-center">
                            <div className="w-full max-w-[800px] flex flex-col space-y-12">
                                {/* è¨­å®šå€ */}
                                <div className="grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-6">
                                    <div className="flex flex-col items-center">
                                        <span className="text-[10px] sm:text-sm font-black text-orange-800/80 mb-2 uppercase">ç·´ç¿’é›£åº¦</span>
                                        <div className="flex bg-[#fff9e6] rounded-xl p-1 border-2 border-[#f9ebbe] w-full h-[50px] sm:h-[60px]">
                                            <button onClick={() => setMode('3x3')} className={`flex-1 rounded-lg font-black ${mode === '3x3' ? 'bg-[#ff8c42] text-white shadow-md' : 'text-orange-900/60'}`}>3x3</button>
                                            <button onClick={() => setMode('4x4')} className={`flex-1 rounded-lg font-black ${mode === '4x4' ? 'bg-[#ff8c42] text-white shadow-md' : 'text-orange-900/60'}`}>4x4</button>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-center">
                                        <span className="text-[10px] sm:text-sm font-black text-orange-800/80 mb-2 uppercase">å¯†ç¢¼è¨­å®š</span>
                                        <div className="flex bg-[#fff9e6] rounded-xl p-1 border-2 border-[#f9ebbe] w-full h-[50px] sm:h-[60px]">
                                            <button onClick={() => setIsRandom(false)} className={`flex-1 rounded-lg font-black ${!isRandom ? 'bg-[#ff8c42] text-white shadow-md' : 'text-orange-900/60'}`}>é †åº</button>
                                            <button onClick={() => setIsRandom(true)} className={`flex-1 rounded-lg font-black ${isRandom ? 'bg-[#ff8c42] text-white shadow-md' : 'text-orange-900/60'}`}>éš¨æ©Ÿ</button>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-center col-span-2 sm:col-span-1">
                                        <span className="text-[10px] sm:text-sm font-black text-orange-800/80 mb-2 uppercase">æ›´æ–°é¡Œç›®</span>
                                        <button onClick={generateNewGame} className="w-full h-[50px] sm:h-[60px] flex items-center justify-center gap-2 bg-white text-[#ff8c42] rounded-xl border-2 border-[#f9ebbe] font-black active:scale-95 transition-all"><Icons.RotateCcw className="w-4 h-4 mr-2" /> æ›ä¸‹ä¸€é¡Œ</button>
                                    </div>
                                </div>

                                <div className="bg-white/70 backdrop-blur-md pt-8 pb-6 px-2 sm:px-8 rounded-[2rem] border-2 border-[#f9ebbe] relative shadow-sm w-full mx-auto max-w-[800px]">
                                    <div className="absolute -top-5 left-1/2 -translate-x-1/2 sm:left-8 sm:translate-x-0"><div className={labelBaseClass}><Icons.Key className="w-4 h-4 mr-1.5" />æ‰¾å‡ºæ­£ç¢ºå¯†ç¢¼</div></div>
                                    <div className={`grid gap-y-4 sm:gap-y-10 mt-4 ${mode === '3x3' ? 'grid-cols-5 gap-x-2' : 'grid-cols-8 gap-x-1 sm:gap-x-4 md:gap-x-6'}`}>
                                        {targetIcons.map((icon) => (
                                            mode === '3x3' ? (
                                                <div key={icon.id} className="relative flex items-center answer-button-cell"> 
                                                    <div className="flex flex-col items-center gap-2 sm:gap-3 w-full">
                                                        <div className="flex items-center justify-center h-12 sm:h-22"><icon.component className="w-10 h-10 sm:w-14 sm:h-14" color={icon.hex} /></div>
                                                        <button onClick={() => setActivePickerId(activePickerId === icon.id ? null : icon.id)} className={`flex items-center justify-center font-black rounded-lg sm:rounded-xl border-2 aspect-square shrink-0 w-9 sm:w-16 text-sm sm:text-3xl ${userAnswers[icon.id] ? 'bg-[#fffcf0] border-[#ff8c42]' : 'bg-[#f8f8f8] border-[#f9ebbe] text-[#ccc]'}`}>{userAnswers[icon.id] || '?'}</button>
                                                    </div>
                                                    {activePickerId === icon.id && (
                                                        <div ref={pickerRef} className="absolute top-[105%] left-1/2 -translate-x-1/2 z-[100] bg-white rounded-xl p-2 shadow-2xl border-4 border-[#f9ebbe] grid gap-1 grid-cols-3 w-28 sm:w-44">
                                                            {Array.from({length: 9}, (_, i) => i + 1).map((n) => (
                                                                <button key={n} onClick={() => { setUserAnswers({...userAnswers, [icon.id]: n}); setActivePickerId(null); }} className="aspect-square flex items-center justify-center text-xs sm:text-xl font-black bg-[#fff9e6] hover:bg-[#ff8c42] hover:text-white rounded-lg transition-colors">{n}</button>
                                                            ))}
                                                        </div>
                                                    )}
                                                </div>
                                            ) : (
                                                <React.Fragment key={icon.id}>
                                                    <div className="flex items-center justify-center w-9 h-9 sm:w-16 sm:h-16"><icon.component className="w-full h-full shrink-0" color={icon.hex} /></div>
                                                    <div className="relative flex items-center justify-center answer-button-cell w-9 h-9 sm:w-16 sm:h-16">
                                                        <button onClick={() => setActivePickerId(activePickerId === icon.id ? null : icon.id)} className={`flex items-center justify-center font-black rounded-lg sm:rounded-xl border-2 aspect-square shrink-0 w-full h-full text-xs sm:text-2xl ${userAnswers[icon.id] ? 'bg-[#fffcf0] border-[#ff8c42]' : 'bg-[#f8f8f8] border-[#f9ebbe] text-[#ccc]'}`}>{userAnswers[icon.id] || '?'}</button>
                                                        {activePickerId === icon.id && (
                                                            <div ref={pickerRef} className="absolute top-[105%] left-1/2 -translate-x-1/2 z-[100] bg-white rounded-xl p-2 shadow-2xl border-4 border-[#f9ebbe] grid gap-1 grid-cols-4 w-36 sm:w-56">
                                                                {Array.from({length: 16}, (_, i) => i + 1).map((n) => (
                                                                    <button key={n} onClick={() => { setUserAnswers({...userAnswers, [icon.id]: n}); setActivePickerId(null); }} className="aspect-square flex items-center justify-center text-xs sm:text-xl font-black bg-[#fff9e6] hover:bg-[#ff8c42] hover:text-white rounded-lg transition-colors">{n}</button>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                </React.Fragment>
                                            )
                                        ))}
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4 sm:gap-8 w-full max-w-[800px] mx-auto">
                                    <div className="flex flex-col items-center">
                                        <div className="mb-4"><div className={labelBaseClass}><Icons.Palette className="w-4 h-4 mr-1.5" />åœ–æ¡ˆåˆ†å¸ƒåœ–</div></div>
                                        <div className="grid gap-1 sm:gap-2 bg-[#fff9e6] p-2 sm:p-5 rounded-2xl border-2 border-[#f9ebbe] w-full aspect-square shadow-inner">
                                            <div className={`grid h-full w-full gap-1 ${mode === '3x3' ? 'grid-cols-3' : 'grid-cols-4'}`}>
                                                {leftGrid.map((item, idx) => (
                                                    <div key={idx} className="aspect-square bg-white rounded-md sm:rounded-xl flex items-center justify-center border border-white/50 overflow-hidden">{item && <item.component className="w-2/3 h-2/3" color={item.hex} />}</div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-center">
                                        <div className="mb-4"><div className={labelBaseClass}><Icons.Hash className="w-4 h-4 mr-1.5" />æ•¸å­—å¯†ç¢¼åœ–</div></div>
                                        <div className="grid gap-1 sm:gap-2 bg-[#fff9e6] p-2 sm:p-5 rounded-2xl border-2 border-[#f9ebbe] w-full aspect-square shadow-inner">
                                            <div className={`grid h-full w-full gap-1 ${mode === '3x3' ? 'grid-cols-3' : 'grid-cols-4'}`}>
                                                {rightGrid.map((num, idx) => (
                                                    <div key={idx} className="aspect-square bg-white rounded-md sm:rounded-xl flex items-center justify-center border border-orange-50 font-black text-xl sm:text-5xl text-[#433422]">{num}</div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* --- å®Œç¾é‚„åŸæŒ‰éˆ•å€ï¼šå¯¬åº¦åˆ‡é½Šã€åœ“è§’ã€é™°å½±ã€ä½ˆå±€ 100% ç›¸åŒ --- */}
                                <div className="grid grid-cols-2 gap-4 sm:gap-8 mt-16 no-print w-full max-w-[800px] mx-auto px-0">
                                    <button 
                                        onClick={checkAnswers} 
                                        className="w-full px-4 py-3.5 sm:py-4 bg-[#ff8c42] text-white rounded-[1.5rem] sm:rounded-[2rem] font-black text-sm sm:text-lg shadow-[0_4px_0_#d35400] active:translate-y-0.5 transition-all"
                                    >
                                        æª¢æŸ¥ç­”æ¡ˆ
                                    </button>
                                    <button 
                                        onClick={handleExportImage} 
                                        className="w-full px-4 py-3.5 sm:py-4 bg-[#433422] text-white rounded-[1.5rem] sm:rounded-[2rem] font-black text-sm sm:text-lg shadow-[0_4px_0_#1a140d] active:translate-y-0.5 transition-all flex items-center justify-center gap-1 sm:gap-3"
                                    >
                                        {isExporting ? <Icons.RefreshCw className="w-4 h-4 animate-spin" /> : <Icons.ImageIcon className="w-4 h-4 sm:w-6 sm:h-6" />}
                                        {isExporting ? 'ç”Ÿæˆä¸­' : 'è¼¸å‡ºåœ–ç‰‡'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* --- æ ¸å¿ƒï¼šè™›æ“¬ A4 å°å‡ºç‰ˆ (ä¿®æ­£æ•¸å­—å‚ç›´ç½®ä¸­èˆ‡ 1:1 ä½ˆå±€) --- */}
                    <div ref={exportContainerRef} style={{ position: 'fixed', left: '-9999px', top: '0', width: '800px', height: '1132px', backgroundColor: 'white', padding: '10px 40px 10px 40px', border: '12px solid #f9ebbe', display: 'none', boxSizing: 'border-box' }}>
                        <div className="w-full h-full flex flex-col" style={{ boxSizing: 'border-box', position: 'relative' }}>
                            <div className="text-center pt-8">
                                <h1 style={{ fontSize: '56px', fontWeight: '900', color: '#433422', letterSpacing: '0.2em', margin: '0 0 35px 0', lineHeight: '1' }}>å°ˆæ³¨åŠ›å­¸ç¿’å–®</h1>
                                <p style={{ fontSize: '18px', color: '#433422', opacity: 0.8, margin: '0 0 45px 0' }}>ç‚ºå°æœ‹å‹æ‰“é€ æœ€æº«é¦¨ã€å°ˆæ¥­çš„è¦–è¦ºæœå°‹èˆ‡ç©ºé–“å°æ‡‰ç·´ç¿’ç©ºé–“</p>
                            </div>
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%', marginBottom: '70px', padding: '0 5px' }}>
                                <div style={{ display: 'flex', alignItems: 'center', fontSize: '28px', fontWeight: '900', color: '#433422' }}>ç­ç´šï¼š<div style={{ width: '220px', borderBottom: '3px solid #433422', height: '32px' }}></div></div>
                                <div style={{ display: 'flex', alignItems: 'center', fontSize: '28px', fontWeight: '900', color: '#433422' }}>å§“åï¼š<div style={{ width: '220px', borderBottom: '3px solid #433422', height: '32px' }}></div></div>
                            </div>
                            <div className="flex-grow flex flex-col" style={{ gap: '40px' }}>
                                <div className="bg-white pt-16 pb-12 px-8 rounded-[2rem] border-2 border-[#f9ebbe] relative">
                                    <div style={{ position: 'absolute', top: '-24px', left: '40px', backgroundColor: '#ff8c42', color: 'white', width: '240px', height: '48px', borderRadius: '999px', display: 'flex', alignItems: 'center', justifyContent: 'center', boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)', gap: '8px' }}>
                                        <Icons.Key className="w-5 h-5" /><span style={{ fontWeight: '900', fontSize: '20px', transform: 'translateY(-9px)' }}>æ‰¾å‡ºæ­£ç¢ºå¯†ç¢¼</span>
                                    </div>
                                    <div className={`grid ${mode === '3x3' ? 'grid-cols-5 gap-12' : 'grid-cols-8 gap-x-4 gap-y-10'}`}>
                                        {targetIcons.map((icon) => (
                                            mode === '3x3' ? (
                                                <div key={icon.id} className="flex flex-col items-center gap-6">
                                                    <div className="flex items-center justify-center" style={{ width: '70px', height: '80px' }}><icon.component className="w-full h-full" color={icon.hex} /></div>
                                                    <div style={{ width: '105px', height: '105px', borderRadius: '14px', border: '4px solid #fff7ed', backgroundColor: '#ffffff' }}></div>
                                                </div>
                                            ) : (
                                                <React.Fragment key={icon.id}>
                                                    <div className="flex items-center justify-center" style={{ width: '85px', height: '85px' }}><icon.component className="w-full h-full" color={icon.hex} /></div>
                                                    <div style={{ width: '85px', height: '85px', borderRadius: '12px', border: '4px solid #fff7ed', backgroundColor: '#ffffff' }}></div>
                                                </React.Fragment>
                                            )
                                        ))}
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-10">
                                    <div className="flex flex-col items-center relative">
                                        <div style={{ backgroundColor: '#ff8c42', color: 'white', width: '260px', height: '48px', borderRadius: '999px', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '25px', gap: '8px' }}>
                                            <Icons.Palette className="w-5 h-5" /><span style={{ fontWeight: '900', fontSize: '20px', transform: 'translateY(-9px)' }}>åœ–æ¡ˆåˆ†å¸ƒåœ–</span>
                                        </div>
                                        <div className="grid gap-2 bg-[#fff9e6] p-4 rounded-[2rem] border-2 border-[#f9ebbe] w-full aspect-square shadow-inner">
                                            <div className={`grid h-full w-full gap-2 ${mode === '3x3' ? 'grid-cols-3' : 'grid-cols-4'}`}>
                                                {leftGrid.map((item, idx) => (
                                                    <div key={idx} className="aspect-square bg-white rounded-2xl flex items-center justify-center">{item && <item.component size="75%" color={item.hex} />}</div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-center relative">
                                        <div style={{ backgroundColor: '#ff8c42', color: 'white', width: '260px', height: '48px', borderRadius: '999px', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '25px', gap: '8px' }}>
                                            <Icons.Hash className="w-5 h-5" /><span style={{ fontWeight: '900', fontSize: '20px', transform: 'translateY(-9px)' }}>æ•¸å­—å¯†ç¢¼åœ–</span>
                                        </div>
                                        <div className="grid gap-2 bg-[#fff9e6] p-4 rounded-[2rem] border-2 border-[#f9ebbe] w-full aspect-square shadow-inner">
                                            <div className={`grid h-full w-full gap-2 ${mode === '3x3' ? 'grid-cols-3' : 'grid-cols-4'}`}>
                                                {rightGrid.map((num, idx) => (
                                                    <div key={idx} className="aspect-square bg-white rounded-2xl flex items-center justify-center font-black text-[#433422]" style={{ fontSize: mode === '3x3' ? '64px' : '48px' }}>
                                                        {/* ä¿®æ­£ï¼šå°‡æ•¸å­—å‚ç›´ä½ç§»æ”¹ç‚º +5% ä¸¦ç¢ºä¿ flex ç½®ä¸­ï¼Œé”æˆè¦–è¦ºå®Œç¾ç½®ä¸­ */}
                                                        <span style={{ transform: 'translateY(5%)', lineHeight: '1' }}>{num}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>