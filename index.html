<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¼å…’å°ˆæ³¨åŠ›å­¸ç¿’å–® - å°ˆæ¥­å¼·åŒ–ç‰ˆ</title>
    <!-- è¼‰å…¥ Noto Serif TC å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ React æ ¸å¿ƒ -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- è¼‰å…¥ Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- è¼‰å…¥ html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        * { font-family: 'Noto Serif TC', serif !important; }
        body { background-color: #fff7ed; -webkit-tap-highlight-color: transparent; }
        @media print { .no-print { display: none !important; } }
        button { outline: none; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        
        /* æ²è»¸ç¾åŒ–ï¼Œç¢ºä¿ä¸è¶…å‡ºæ¡†ç·š */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #fef3c7; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #ff8c42; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- SVG åœ–æ¨™çµ„ä»¶ ---
        const IconWrapper = ({ children, color, className, style, fill = "currentColor", strokeWidth = 0 }) => (
            <svg viewBox="0 0 24 24" className={className} style={{ color, ...style }} fill={fill} stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round">{children}</svg>
        );

        const Icons = {
            Star: (p) => <IconWrapper {...p}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></IconWrapper>,
            Moon: (p) => <IconWrapper {...p}><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></IconWrapper>,
            Heart: (p) => <IconWrapper {...p}><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></IconWrapper>,
            Cloud: (p) => <IconWrapper {...p}><path d="M17.5 19c2.5 0 4.5-2 4.5-4.5 0-2.4-1.8-4.3-4.2-4.5a7 7 0 1 0-13.3 2c-1.5.3-2.5 1.5-2.5 3 0 1.7 1.3 3 3 3h12.5z"/></IconWrapper>,
            Ghost: (p) => <IconWrapper {...p}><path d="M9 10h.01M15 10h.01M12 2a8 8 0 0 0-8 8v12l3-3 2.5 2.5L12 19l2.5 2.5L17 19l3 3V10a8 8 0 0 0-8-8z"/></IconWrapper>,
            Flag: (p) => <IconWrapper {...p}><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1zM4 22v-7"/></IconWrapper>,
            Fish: (p) => <IconWrapper {...p}><path d="M7 15l-4-4 4-4M10 11.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM22 11c-2-4-5-6-10-6s-8 3-8 6 3 6 8 6 8-2 10-6z"/></IconWrapper>,
            Plane: (p) => <IconWrapper {...p}><path d="M17.8 19.2L16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z"/></IconWrapper>,
            Gift: (p) => <IconWrapper {...p}><polyline points="20 12 20 22 4 22 4 12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></IconWrapper>,
            Apple: (p) => <IconWrapper {...p}><path d="M12 22c4.97 0 9-3.03 9-7.14 0-.3-.02-.6-.05-.89A4 4 0 0 0 17 8c-2.1 0-3.1 1.1-4.1 2.2C11.9 9.1 10.9 8 8.8 8A4 4 0 0 0 4 13.97c-.03.29-.05.59-.05.89C3.95 18.97 7.98 22 12.95 22z"/><path d="M12 8c0-3.5 2-5 2-5"/></IconWrapper>,
            Rocket: (p) => <IconWrapper {...p}><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="M12 15l-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/><path d="M9 12H4s.5-1 1-4c2 1 3 2 4 4z"/><path d="M15 15v5c-1 .5-4 1-4 1s1-1 2-4z"/><line x1="15" y1="9" x2="15.01" y2="9"/></IconWrapper>,
            Home: (p) => <IconWrapper {...p}><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></IconWrapper>,
            Sparkles: (p) => <IconWrapper {...p} fill="none" strokeWidth="2"><path d="M12 3l1.91 5.82L21 12l-7.09 3.18L12 21l-1.91-5.82L3 12l7.09-3.18L12 3z"/></IconWrapper>,
            RotateCcw: (p) => <IconWrapper {...p} fill="none" strokeWidth="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconWrapper>,
            Key: (p) => <IconWrapper {...p} fill="none" strokeWidth="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.78 7.78 5.5 5.5 0 0 1 7.78-7.78zM15 8l2 2m-5 5l7-7"/></IconWrapper>,
            Palette: (p) => <IconWrapper {...p} fill="none" strokeWidth="2"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.9 0 1.6-.7 1.6-1.6 0-.4-.2-.8-.5-1.1-.3-.3-.5-.7-.5-1.2 0-.9.7-1.6 1.6-1.6H16c3.3 0 6-2.7 6-6 0-4.4-4.5-8-10-8z"/></IconWrapper>,
            Hash: (p) => <IconWrapper {...p} fill="none" strokeWidth="2"><line x1="4" y1="9" x2="20" y2="9"/><line x1="4" y1="15" x2="20" y2="15"/><line x1="10" y1="3" x2="8" y2="21"/><line x1="16" y1="3" x2="14" y2="21"/></IconWrapper>,
            ImageIcon: (p) => <IconWrapper {...p} fill="none" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></IconWrapper>,
            RefreshCw: (p) => <IconWrapper {...p} fill="none" strokeWidth="2"><path d="M21 2v6h-6"/><path d="M3 12a9 9 0 0 1 15-6.7L21 8"/><path d="M3 22v-6h6"/><path d="M21 12a9 9 0 0 1-15 6.7L3 16"/></IconWrapper>,
            Info: (p) => <IconWrapper {...p} fill="none" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></IconWrapper>,
            X: (p) => <IconWrapper {...p} fill="none" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></IconWrapper>,
            Circle: (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/></IconWrapper>,
            Triangle: (p) => <IconWrapper {...p}><path d="M12 2L22 20H2L12 2Z"/></IconWrapper>,
            Square: (p) => <IconWrapper {...p}><rect x="3" y="3" width="18" height="18" rx="2"/></IconWrapper>,
            Trash2: (p) => <IconWrapper {...p} fill="none" strokeWidth="2"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6"/></IconWrapper>
        };

        const App = () => {
            const [mode, setMode] = useState('3x3');
            const [isRandom, setIsRandom] = useState(true);
            const [leftGrid, setLeftGrid] = useState([]);
            const [rightGrid, setRightGrid] = useState([]);
            const [targetIcons, setTargetIcons] = useState([]);
            const [userAnswers, setUserAnswers] = useState({});
            const [activePickerId, setActivePickerId] = useState(null);
            const [isExporting, setIsExporting] = useState(false);
            const [checkResult, setCheckResult] = useState(null);
            const [showGuide, setShowGuide] = useState(false);
            const exportContainerRef = useRef(null);
            const pickerRef = useRef(null);

            const themeColors = { orange: '#ff8c42', amber: '#f59e0b', caramel: '#d35400', deepCocoa: '#433422', cardBg: '#fff9e6' };

            const iconPool = [
                { id: 'star', component: Icons.Star, hex: themeColors.orange },
                { id: 'moon', component: Icons.Moon, hex: themeColors.amber },
                { id: 'heart', component: Icons.Heart, hex: themeColors.caramel },
                { id: 'cloud', component: Icons.Cloud, hex: themeColors.orange },
                { id: 'ghost', component: Icons.Ghost, hex: themeColors.amber },
                { id: 'flag', component: Icons.Flag, hex: themeColors.caramel },
                { id: 'fish', component: Icons.Fish, hex: themeColors.orange },
                { id: 'plane', component: Icons.Plane, hex: themeColors.amber },
                { id: 'gift', component: Icons.Gift, hex: themeColors.caramel },
                { id: 'apple', component: Icons.Apple, hex: themeColors.orange },
                { id: 'rocket', component: Icons.Rocket, hex: themeColors.amber },
                { id: 'home', component: Icons.Home, hex: themeColors.caramel },
                { id: 'circle', component: Icons.Circle, hex: themeColors.orange },
                { id: 'triangle', component: Icons.Triangle, hex: themeColors.amber },
                { id: 'square', component: Icons.Square, hex: themeColors.caramel }
            ];

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (activePickerId && pickerRef.current && !pickerRef.current.contains(event.target)) {
                        if (!event.target.closest('.answer-button-cell')) {
                            setActivePickerId(null);
                        }
                    }
                };
                document.addEventListener('mousedown', handleClickOutside);
                return () => document.removeEventListener('mousedown', handleClickOutside);
            }, [activePickerId]);

            const generateNewGame = () => {
                const is3x3 = mode === '3x3';
                const gridSize = is3x3 ? 9 : 16;
                const side = is3x3 ? 3 : 4;
                const targetCount = is3x3 ? 5 : 8;
                const shuffledIcons = [...iconPool].sort(() => 0.5 - Math.random()).slice(0, targetCount);
                setTargetIcons(shuffledIcons);

                let leftPositions;
                let attempts = 0;
                while (attempts < 20) {
                    leftPositions = Array(gridSize).fill(null);
                    const indices = Array.from({length: gridSize}, (_, i) => i).sort(() => 0.5 - Math.random());
                    const chosen = indices.slice(0, targetCount);
                    const rowCounts = Array(side).fill(0);
                    const colCounts = Array(side).fill(0);
                    chosen.forEach(idx => {
                        rowCounts[Math.floor(idx / side)]++;
                        colCounts[idx % side]++;
                    });
                    if (!rowCounts.some(c => c > (is3x3 ? 2 : 3)) && !colCounts.some(c => c > (is3x3 ? 2 : 3)) || attempts === 19) {
                        chosen.forEach((idx, i) => { leftPositions[idx] = shuffledIcons[i]; });
                        break;
                    }
                    attempts++;
                }
                setLeftGrid(leftPositions);
                let rightNumbers = Array.from({length: gridSize}, (_, i) => i + 1);
                if (isRandom) rightNumbers.sort(() => 0.5 - Math.random());
                setRightGrid(rightNumbers);
                setUserAnswers({});
                setActivePickerId(null);
                setCheckResult(null);
            };

            useEffect(() => { generateNewGame(); }, [mode, isRandom]);

            const handleExportImage = async () => {
                if (isExporting) return;
                setIsExporting(true);
                const exportArea = exportContainerRef.current;
                exportArea.style.display = 'block';
                try {
                    const canvas = await html2canvas(exportArea, { scale: 3, useCORS: true, backgroundColor: '#ffffff', width: 800, height: 1132 });
                    const link = document.createElement('a');
                    link.href = canvas.toDataURL("image/png", 1.0);
                    link.download = `å¹¼å…’å°ˆæ³¨åŠ›ç·´ç¿’å–®_${mode}.png`;
                    link.click();
                } catch (err) { console.error(err); }
                finally { exportArea.style.display = 'none'; setIsExporting(false); }
            };

            const checkAnswers = () => {
                let allCorrect = true;
                let answeredAll = true;
                targetIcons.forEach(icon => {
                    const posIndex = leftGrid.findIndex(item => item && item.id === icon.id);
                    const correctNumber = rightGrid[posIndex];
                    if (!userAnswers[icon.id]) answeredAll = false;
                    if (parseInt(userAnswers[icon.id]) !== correctNumber) allCorrect = false;
                });
                if (!answeredAll) setCheckResult({ success: false, text: 'é‚„æœ‰æ ¼å­æ²’å¡«å®Œå–”ï¼' });
                else if (allCorrect) setCheckResult({ success: true, text: 'å¤ªæ£’äº†ï¼å…¨éƒ¨éƒ½ç­”å°äº†ï¼' });
                else setCheckResult({ success: false, text: 'å“å‘€ï¼Œæœ‰äº›åœ°æ–¹å¡«éŒ¯äº†ï¼Œå†æ‰¾æ‰¾çœ‹å§ï¼' });
            };

            const labelBaseClass = "bg-[#ff8c42] text-white px-4 sm:px-8 py-2.5 sm:h-12 rounded-full font-black text-[10px] sm:text-lg tracking-widest shadow-md flex items-center justify-center gap-1.5 sm:gap-2 leading-none whitespace-nowrap";

            return (
                <div className="min-h-screen p-2 sm:p-4 md:p-8 selection:bg-orange-200 relative">
                    
                    {/* ä½¿ç”¨èªªæ˜å½ˆçª— */}
                    {showGuide && (
                        <div className="fixed inset-0 z-[300] flex items-center justify-center p-4 bg-black/60 backdrop-blur-md no-print" onClick={() => setShowGuide(false)}>
                            <div className="bg-white rounded-[2.5rem] max-w-lg w-full shadow-2xl border-4 border-[#f9ebbe] fade-in relative flex flex-col max-h-[85vh] overflow-hidden" onClick={e => e.stopPropagation()}>
                                <div className="p-6 sm:p-8 pb-4 flex justify-between items-center">
                                    <h2 className="text-xl font-black text-orange-950 flex items-center gap-2">ğŸ§© å°ˆæ³¨åŠ›å­¸ç¿’å–®ï¼šå¿«é€ŸæŒ‡å—</h2>
                                    <button onClick={() => setShowGuide(false)} className="text-orange-900/40 hover:text-[#ff8c42] transition-colors"><Icons.X className="w-7 h-7" /></button>
                                </div>
                                <div className="flex-grow overflow-y-auto px-6 sm:px-10 pb-10 custom-scrollbar">
                                    <div className="space-y-6 text-[#433422] text-base leading-relaxed text-left">
                                        <p className="font-bold">é€™æ˜¯ä¸€æ¬¾å°ˆç‚º 4-8 æ­²å­©ç«¥è¨­è¨ˆçš„ã€Œåœ–æ ¼å°æ‡‰ã€è¨“ç·´å·¥å…·ï¼Œç”¨ä¾†æå‡å­©å­çš„å°ˆæ³¨åŠ›èˆ‡è¦–è¦ºç©ºé–“æ„Ÿã€‚</p>
                                        <section>
                                            <h3 className="text-base font-black text-[#ff8c42] mb-2 flex items-center gap-2 underline underline-offset-4 decoration-2">ğŸ’¡ ç‚ºä»€éº¼è¦ç©é€™å€‹ï¼Ÿ</h3>
                                            <ul className="space-y-1 font-bold">
                                                <li className="flex gap-2"><span>â€¢</span> <span>è¨“ç·´å°ˆæ³¨åŠ›ï¼šå­©å­å¿…é ˆåœ¨é›œäº‚ä¸­æœå°‹ç›®æ¨™ï¼Œæå‡è¦–è¦ºæœå°‹æ•ˆç‡ã€‚</span></li>
                                                <li className="flex gap-2"><span>â€¢</span> <span>å»ºç«‹ç©ºé–“æ„Ÿï¼šç·´ç¿’å·¦å³åœ–è¡¨é–“çš„åº§æ¨™å°æ‡‰é‚è¼¯ï¼Œå¼·åŒ–ç©ºé–“ä½ç½®æ„Ÿã€‚</span></li>
                                            </ul>
                                        </section>
                                        <section>
                                            <h3 className="text-base font-black text-[#ff8c42] mb-2 flex items-center gap-2 underline underline-offset-4 decoration-2">ğŸ•¹ï¸ éŠæˆ²å››éƒ¨æ›²</h3>
                                            <ul className="space-y-1 font-bold">
                                                <li className="flex gap-2"><span>1.</span> <span>çœ‹ç›®æ¨™ï¼šè§€å¯Ÿæœ€ä¸Šæ–¹éœ€è¦æ‰¾å‡ºå“ªäº›åœ–æ¡ˆã€‚</span></li>
                                                <li className="flex gap-2"><span>2.</span> <span>æ‰¾ä½ç½®ï¼šåœ¨å·¦é‚Šã€Œåœ–æ¡ˆåˆ†å¸ƒåœ–ã€è£¡æ‰¾å‡ºè©²åœ–æ¡ˆåœ¨å“ªè£¡ã€‚</span></li>
                                                <li className="flex gap-2"><span>3.</span> <span>å°æ•¸å­—ï¼šçœ‹å³é‚Šã€Œæ•¸å­—å¯†ç¢¼åœ–ã€ç›¸åŒä½ç½®å°æ‡‰çš„æ•¸å­—ã€‚</span></li>
                                                <li className="flex gap-2"><span>4.</span> <span>å¡«ç­”æ¡ˆï¼šé»æ“Šä¸Šæ–¹ç©ºæ ¼ï¼Œå¡«å…¥æ‰¾åˆ°çš„æ•¸å­—å¯†ç¢¼ã€‚</span></li>
                                            </ul>
                                        </section>
                                        <section>
                                            <h3 className="text-base font-black text-[#ff8c42] mb-2 flex items-center gap-2 underline underline-offset-4 decoration-2">ğŸ› ï¸ æ•™å¸«èˆ‡å®¶é•·æ§åˆ¶é …</h3>
                                            <ul className="space-y-1 font-bold">
                                                <li className="flex gap-2"><span>â€¢</span> <span>é›£åº¦åˆ‡æ›ï¼š3x3 (å…¥é–€) / 4x4 (é€²éšæŒ‘æˆ°)ã€‚</span></li>
                                                <li className="flex gap-2"><span>â€¢</span> <span>å¯†ç¢¼è¨­å®šï¼šé †åº (é©åˆåˆå­¸) / éš¨æ©Ÿ (é«˜é›£åº¦è¾¨è­˜)ã€‚</span></li>
                                                <li className="flex gap-2"><span>â€¢</span> <span>æ›ä¸‹ä¸€é¡Œï¼šä¸€éµç”Ÿæˆå…¨æ–°é¡Œç›®ï¼Œå…§å®¹æ°¸é ä¸é‡è¤‡ã€‚</span></li>
                                                <li className="flex gap-2"><span>â€¢</span> <span>è¼¸å‡ºåœ–ç‰‡ï¼šä¸‹è¼‰ç¬¦åˆ A4 æ¯”ä¾‹çš„å­¸ç¿’å–®åœ–ç‰‡ï¼Œæ–¹ä¾¿ç›´æ¥åˆ—å°ã€‚</span></li>
                                            </ul>
                                        </section>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* çµæœæç¤ºè¦–çª— */}
                    {checkResult && (
                        <div className="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/40 backdrop-blur-sm no-print" onClick={() => setCheckResult(null)}>
                            <div className="bg-white rounded-[2rem] p-8 max-w-sm w-full shadow-2xl border-4 border-[#f9ebbe] text-center fade-in" onClick={e => e.stopPropagation()}>
                                <div className="text-6xl mb-4">{checkResult.success ? 'ğŸ‰' : 'ğŸ’¡'}</div>
                                <h2 className="text-2xl font-black text-orange-950 mb-6">{checkResult.text}</h2>
                                <button onClick={() => setCheckResult(null)} className="w-full py-3 bg-[#ff8c42] text-white rounded-xl font-black shadow-[0_4px_0_#d35400] active:translate-y-1">çŸ¥é“äº†</button>
                            </div>
                        </div>
                    )}

                    <div className="max-w-5xl mx-auto bg-white rounded-[2rem] shadow-xl overflow-hidden border-[6px] sm:border-[12px] border-[#f9ebbe] flex flex-col no-print pb-12 relative">
                        {/* å³ä¸Šè§’ Info æŒ‰éˆ• */}
                        <button 
                            onClick={() => setShowGuide(true)}
                            className="absolute top-4 right-4 sm:top-8 sm:right-8 bg-[#fff9e6] text-[#ff8c42] p-2.5 sm:p-3 rounded-full border-2 border-[#f9ebbe] hover:bg-[#ff8c42] hover:text-white transition-all shadow-sm group active:scale-95 z-20"
                            title="ä½¿ç”¨èªªæ˜"
                        >
                            <Icons.Info className="w-6 h-6 sm:w-8 sm:h-8" />
                        </button>

                        <div className="text-center pt-10 pb-0 px-4">
                            <div className="inline-flex items-center gap-2 px-3 py-1 bg-orange-100 text-[#ff8c42] rounded-full text-xs font-black tracking-widest mb-3 shadow-sm"><Icons.Sparkles className="w-3.5 h-3.5" /> æ•™å­¸è¼”åŠ©å·¥å…·</div>
                            <h1 className="text-3xl sm:text-5xl font-[900] text-orange-950 tracking-[0.15em] mb-3 leading-tight">å°ˆæ³¨åŠ›å­¸ç¿’å–®</h1>
                            <p className="text-[#433422]/80 font-normal text-[10px] sm:text-[14px] mb-4">ç‚ºå°æœ‹å‹æ‰“é€ æœ€æº«é¦¨ã€å°ˆæ¥­çš„è¦–è¦ºæœå°‹èˆ‡ç©ºé–“å°æ‡‰ç·´ç¿’ç©ºé–“</p>
                        </div>

                        <div className="p-3 sm:p-10 pt-4 flex-grow flex flex-col items-center">
                            <div className="w-full max-w-[800px] flex flex-col space-y-12">
                                <div className="grid grid-cols-2 sm:grid-cols-3 gap-3 sm:gap-6">
                                    <div className="flex flex-col items-center">
                                        <span className="text-[10px] sm:text-sm font-black text-orange-800/80 mb-2 uppercase">ç·´ç¿’é›£åº¦</span>
                                        <div className="flex bg-[#fff9e6] rounded-xl p-1 border-2 border-[#f9ebbe] w-full h-[50px] sm:h-[60px]">
                                            <button onClick={() => setMode('3x3')} className={`flex-1 rounded-lg font-black ${mode === '3x3' ? 'bg-[#ff8c42] text-white shadow-md' : 'text-orange-900/60'}`}>3x3</button>
                                            <button onClick={() => setMode('4x4')} className={`flex-1 rounded-lg font-black ${mode === '4x4' ? 'bg-[#ff8c42] text-white shadow-md' : 'text-orange-900/60'}`}>4x4</button>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-center">
                                        <span className="text-[10px] sm:text-sm font-black text-orange-800/80 mb-2 uppercase">å¯†ç¢¼è¨­å®š</span>
                                        <div className="flex bg-[#fff9e6] rounded-xl p-1 border-2 border-[#f9ebbe] w-full h-[50px] sm:h-[60px]">
                                            <button onClick={() => setIsRandom(false)} className={`flex-1 rounded-lg font-black ${!isRandom ? 'bg-[#ff8c42] text-white shadow-md' : 'text-orange-900/60'}`}>é †åº</button>
                                            <button onClick={() => setIsRandom(true)} className={`flex-1 rounded-lg font-black ${isRandom ? 'bg-[#ff8c42] text-white shadow-md' : 'text-orange-900/60'}`}>éš¨æ©Ÿ</button>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-center col-span-2 sm:col-span-1">
                                        <span className="text-[10px] sm:text-sm font-black text-orange-800/80 mb-2 uppercase">æ›´æ–°é¡Œç›®</span>
                                        <button onClick={generateNewGame} className="w-full h-[50px] sm:h-[60px] flex items-center justify-center gap-2 bg-white text-[#ff8c42] rounded-xl border-2 border-[#f9ebbe] font-black active:scale-95 transition-all"><Icons.RotateCcw className="w-4 h-4 mr-2" /> æ›ä¸‹ä¸€é¡Œ</button>
                                    </div>
                                </div>

                                <div className="bg-white/70 backdrop-blur-md pt-8 pb-6 px-2 sm:px-8 rounded-[2rem] border-2 border-[#f9ebbe] relative shadow-sm w-full mx-auto max-w-[800px]">
                                    <div className="absolute -top-5 left-1/2 -translate-x-1/2 sm:left-8 sm:translate-x-0"><div className={labelBaseClass}><Icons.Key className="w-4 h-4 mr-1.5" />æ‰¾å‡ºæ­£ç¢ºå¯†ç¢¼</div></div>
                                    <div className={`grid gap-y-4 sm:gap-y-10 mt-4 ${mode === '3x3' ? 'grid-cols-5 gap-x-2' : 'grid-cols-8 gap-x-1 sm:gap-x-4 md:gap-x-6'}`}>
                                        {targetIcons.map((icon) => (
                                            mode === '3x3' ? (
                                                <div key={icon.id} className="relative flex items-center answer-button-cell"> 
                                                    <div className="flex flex-col items-center gap-2 sm:gap-3 w-full">
                                                        <div className="flex items-center justify-center h-12 sm:h-22"><icon.component className="w-10 h-10 sm:w-14 sm:h-14" color={icon.hex} /></div>
                                                        <button onClick={() => setActivePickerId(activePickerId === icon.id ? null : icon.id)} className={`flex items-center justify-center font-black rounded-lg sm:rounded-xl border-2 aspect-square shrink-0 w-9 sm:w-16 text-sm sm:text-3xl ${userAnswers[icon.id] ? 'bg-[#fffcf0] border-[#ff8c42]' : 'bg-[#f8f8f8] border-[#f9ebbe] text-[#ccc]'}`}>{userAnswers[icon.id] || '?'}</button>
                                                    </div>
                                                    {activePickerId === icon.id && (
                                                        <div ref={pickerRef} className="absolute top-[105%] left-1/2 -translate-x-1/2 z-[100] bg-white rounded-xl p-3 shadow-2xl border-4 border-[#f9ebbe] flex flex-col gap-3 w-32 sm:w-48">
                                                            <div className="grid gap-1 grid-cols-3">
                                                                {Array.from({length: 9}, (_, i) => i + 1).map((n) => (
                                                                    <button key={n} onClick={() => { setUserAnswers({...userAnswers, [icon.id]: n}); setActivePickerId(null); }} className="aspect-square flex items-center justify-center text-xs sm:text-xl font-black bg-[#fff9e6] hover:bg-[#ff8c42] hover:text-white rounded-lg transition-colors">{n}</button>
                                                                ))}
                                                            </div>
                                                            {/* å°éµç›¤æ“ä½œå€ï¼šç§»é™¤åˆ†éš”æ©«ç·šï¼Œæ›´æ›æŒ‰éˆ•æ–‡å­— */}
                                                            <div className="grid grid-cols-2 gap-2">
                                                                <button onClick={() => { setUserAnswers({...userAnswers, [icon.id]: null}); setActivePickerId(null); }} className="flex items-center justify-center py-1.5 bg-orange-100 text-orange-700 rounded-lg text-[10px] sm:text-xs font-black hover:bg-orange-200 transition-colors">æ¸…é™¤</button>
                                                                <button onClick={() => setActivePickerId(null)} className="flex items-center justify-center py-1.5 bg-gray-100 text-gray-700 rounded-lg text-[10px] sm:text-xs font-black hover:bg-gray-200 transition-colors">é—œé–‰</button>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            ) : (
                                                <React.Fragment key={icon.id}>
                                                    <div className="flex items-center justify-center w-9 h-9 sm:w-16 sm:h-16"><icon.component className="w-full h-full shrink-0" color={icon.hex} /></div>
                                                    <div className="relative flex items-center justify-center answer-button-cell w-9 h-9 sm:w-16 sm:h-16">
                                                        <button onClick={() => setActivePickerId(activePickerId === icon.id ? null : icon.id)} className={`flex items-center justify-center font-black rounded-lg sm:rounded-xl border-2 aspect-square shrink-0 w-full h-full text-xs sm:text-2xl ${userAnswers[icon.id] ? 'bg-[#fffcf0] border-[#ff8c42]' : 'bg-[#f8f8f8] border-[#f9ebbe] text-[#ccc]'}`}>{userAnswers[icon.id] || '?'}</button>
                                                        {activePickerId === icon.id && (
                                                            <div ref={pickerRef} className="absolute top-[105%] left-1/2 -translate-x-1/2 z-[100] bg-white rounded-xl p-3 shadow-2xl border-4 border-[#f9ebbe] flex flex-col gap-3 w-40 sm:w-60">
                                                                <div className="grid gap-1 grid-cols-4">
                                                                    {Array.from({length: 16}, (_, i) => i + 1).map((n) => (
                                                                        <button key={n} onClick={() => { setUserAnswers({...userAnswers, [icon.id]: n}); setActivePickerId(null); }} className="aspect-square flex items-center justify-center text-xs sm:text-xl font-black bg-[#fff9e6] hover:bg-[#ff8c42] hover:text-white rounded-lg transition-colors">{n}</button>
                                                                    ))}
                                                                </div>
                                                                {/* å°éµç›¤æ“ä½œå€ï¼šç§»é™¤åˆ†éš”æ©«ç·šï¼Œæ›´æ›æŒ‰éˆ•æ–‡å­— */}
                                                                <div className="grid grid-cols-2 gap-2">
                                                                    <button onClick={() => { setUserAnswers({...userAnswers, [icon.id]: null}); setActivePickerId(null); }} className="flex items-center justify-center py-1.5 bg-orange-100 text-orange-700 rounded-lg text-[10px] sm:text-xs font-black hover:bg-orange-200 transition-colors">æ¸…é™¤</button>
                                                                    <button onClick={() => setActivePickerId(null)} className="flex items-center justify-center py-1.5 bg-gray-100 text-gray-700 rounded-lg text-[10px] sm:text-xs font-black hover:bg-gray-200 transition-colors">é—œé–‰</button>
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </React.Fragment>
                                            )
                                        ))}
                                    </div>
                                </div>

                                <div className="grid grid-cols-2 gap-4 sm:gap-8 w-full max-w-[800px] mx-auto">
                                    <div className="flex flex-col items-center">
                                        <div className="mb-4"><div className={labelBaseClass}><Icons.Palette className="w-4 h-4 mr-1.5" />åœ–æ¡ˆåˆ†å¸ƒåœ–</div></div>
                                        <div className="grid gap-1 sm:gap-2 bg-[#fff9e6] p-2 sm:p-5 rounded-2xl border-2 border-[#f9ebbe] w-full aspect-square shadow-inner">
                                            <div className={`grid h-full w-full gap-1 ${mode === '3x3' ? 'grid-cols-3' : 'grid-cols-4'}`}>
                                                {leftGrid.map((item, idx) => (
                                                    <div key={idx} className="aspect-square bg-white rounded-md sm:rounded-xl flex items-center justify-center border border-white/50 overflow-hidden">{item && <item.component className="w-2/3 h-2/3" color={item.hex} />}</div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-center">
                                        <div className="mb-4"><div className={labelBaseClass}><Icons.Hash className="w-4 h-4 mr-1.5" />æ•¸å­—å¯†ç¢¼åœ–</div></div>
                                        <div className="grid gap-1 sm:gap-2 bg-[#fff9e6] p-2 sm:p-5 rounded-2xl border-2 border-[#f9ebbe] w-full aspect-square shadow-inner">
                                            <div className={`grid h-full w-full gap-1 ${mode === '3x3' ? 'grid-cols-3' : 'grid-cols-4'}`}>
                                                {rightGrid.map((num, idx) => (
                                                    <div key={idx} className="aspect-square bg-white rounded-md sm:rounded-xl flex items-center justify-center border border-orange-50 font-black text-xl sm:text-5xl text-[#433422]">{num}</div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* ä¸‹æ–¹æŒ‰éˆ•å€ */}
                                <div className="grid grid-cols-2 gap-4 sm:gap-8 no-print w-full max-w-[800px] mx-auto px-0 mt-8">
                                    <button onClick={checkAnswers} className="w-full py-3.5 sm:py-4 bg-[#ff8c42] text-white rounded-[1.5rem] sm:rounded-[2rem] font-black text-sm sm:text-lg shadow-[0_4px_0_#d35400] active:translate-y-0.5 transition-all">æª¢æŸ¥ç­”æ¡ˆ</button>
                                    <button onClick={handleExportImage} className="w-full py-3.5 sm:py-4 bg-[#433422] text-white rounded-[1.5rem] sm:rounded-[2rem] font-black text-sm sm:text-lg shadow-[0_4px_0_#1a140d] active:translate-y-0.5 transition-all flex items-center justify-center gap-1 sm:gap-3">
                                        {isExporting ? <Icons.RefreshCw className="w-4 h-4 animate-spin" /> : <Icons.ImageIcon className="w-4 h-4 sm:w-6 sm:h-6" />}
                                        {isExporting ? 'ç”Ÿæˆä¸­' : 'è¼¸å‡ºåœ–ç‰‡'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* --- æ ¸å¿ƒï¼šè™›æ“¬ A4 å°å‡ºç‰ˆ (LOCK AREA - æ¨™è¨»é–å®šï¼šåº•ç·šã€ç½®ä¸­ã€ç„¡é™°å½±) --- */}
                    <div ref={exportContainerRef} style={{ position: 'fixed', left: '-9999px', top: '0', width: '800px', height: '1132px', backgroundColor: 'white', padding: '10px 25px 10px 25px', border: '12px solid #f9ebbe', display: 'none', boxSizing: 'border-box' }}>
                        <div className="w-full h-full flex flex-col" style={{ boxSizing: 'border-box', position: 'relative' }}>
                            <div className="text-center pt-8">
                                <h1 style={{ fontSize: '56px', fontWeight: '900', color: '#433422', letterSpacing: '0.2em', margin: '0 0 35px 0', lineHeight: '1' }}>å°ˆæ³¨åŠ›å­¸ç¿’å–®</h1>
                                <p style={{ fontSize: '18px', color: '#433422', opacity: 0.8, margin: '0 0 45px 0' }}>ç‚ºå°æœ‹å‹æ‰“é€ æœ€æº«é¦¨ã€å°ˆæ¥­çš„è¦–è¦ºæœå°‹èˆ‡ç©ºé–“å°æ‡‰ç·´ç¿’ç©ºé–“</p>
                            </div>
                            
                            {/* LOCK: ç­ç´šå§“ååº•ç·šå°é½Š */}
                            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end', width: '100%', marginBottom: '70px', padding: '0 5px' }}>
                                <div style={{ display: 'flex', alignItems: 'flex-end', fontSize: '28px', fontWeight: '900', color: '#433422' }}>
                                    <span style={{ paddingBottom: '2px' }}>ç­ç´šï¼š</span>
                                    <div style={{ width: '220px', borderBottom: '3px solid #433422' }}></div>
                                </div>
                                <div style={{ display: 'flex', alignItems: 'flex-end', fontSize: '28px', fontWeight: '900', color: '#433422' }}>
                                    <span style={{ paddingBottom: '2px' }}>å§“åï¼š</span>
                                    <div style={{ width: '220px', borderBottom: '3px solid #433422' }}></div>
                                </div>
                            </div>

                            <div className="flex-grow flex flex-col" style={{ gap: '40px' }}>
                                <div className="bg-white pt-12 pb-8 px-8 rounded-[2rem] border-2 border-[#f9ebbe] relative">
                                    <div style={{ position: 'absolute', top: '-24px', left: '40px', backgroundColor: '#ff8c42', color: 'white', width: '240px', height: '48px', borderRadius: '999px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}>
                                        <Icons.Key className="w-5 h-5" /><span style={{ fontWeight: '900', fontSize: '20px', transform: 'translateY(-9px)' }}>æ‰¾å‡ºæ­£ç¢ºå¯†ç¢¼</span>
                                    </div>
                                    <div className={`grid ${mode === '3x3' ? 'grid-cols-5 gap-12' : 'grid-cols-8 gap-x-[11px] gap-y-1'}`}>
                                        {targetIcons.map((icon) => (
                                            mode === '3x3' ? (
                                                <div key={icon.id} className="flex flex-col items-center gap-1">
                                                    <div className="flex items-center justify-center" style={{ width: '70px', height: '80px' }}><icon.component className="w-full h-full" color={icon.hex} /></div>
                                                    <div style={{ width: '105px', height: '105px', borderRadius: '14px', border: '4px solid #fff7ed', backgroundColor: '#ffffff' }}></div>
                                                </div>
                                            ) : (
                                                <React.Fragment key={icon.id}>
                                                    <div className="flex items-center justify-center" style={{ width: '85px', height: '85px' }}><icon.component className="w-full h-full" color={icon.hex} /></div>
                                                    <div style={{ width: '85px', height: '85px', borderRadius: '12px', border: '4px solid #fff7ed', backgroundColor: '#ffffff', flexShrink: 0 }}></div>
                                                </React.Fragment>
                                            )
                                        ))}
                                    </div>
                                </div>
                                <div className="grid grid-cols-2 gap-10">
                                    <div className="flex flex-col items-center relative">
                                        <div style={{ backgroundColor: '#ff8c42', color: 'white', width: '260px', height: '48px', borderRadius: '999px', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '25px', gap: '8px' }}>
                                            <Icons.Palette className="w-5 h-5" /><span style={{ fontWeight: '900', fontSize: '20px', transform: 'translateY(-9px)' }}>åœ–æ¡ˆåˆ†å¸ƒåœ–</span>
                                        </div>
                                        <div className="grid gap-2 bg-[#fff9e6] p-4 rounded-[2rem] border-2 border-[#f9ebbe] w-full aspect-square">
                                            <div className={`grid h-full w-full gap-2 ${mode === '3x3' ? 'grid-cols-3' : 'grid-cols-4'}`}>
                                                {leftGrid.map((item, idx) => (
                                                    <div key={idx} className="aspect-square bg-white rounded-2xl flex items-center justify-center border border-[#fffcf0]">{item && <item.component size="75%" color={item.hex} />}</div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex flex-col items-center relative">
                                        <div style={{ backgroundColor: '#ff8c42', color: 'white', width: '260px', height: '48px', borderRadius: '999px', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '25px', gap: '8px' }}>
                                            <Icons.Hash className="w-5 h-5" /><span style={{ fontWeight: '900', fontSize: '20px', transform: 'translateY(-9px)' }}>æ•¸å­—å¯†ç¢¼åœ–</span>
                                        </div>
                                        <div className="grid gap-2 bg-[#fff9e6] p-4 rounded-[2rem] border-2 border-[#f9ebbe] w-full aspect-square">
                                            <div className={`grid h-full w-full gap-2 ${mode === '3x3' ? 'grid-cols-3' : 'grid-cols-4'}`}>
                                                {rightGrid.map((num, idx) => (
                                                    <div key={idx} className="aspect-square bg-white rounded-2xl flex items-center justify-center font-black text-[#433422]" style={{ fontSize: mode === '3x3' ? '64px' : '48px', border: '1px solid #fed7aa' }}>
                                                        {/* LOCK: æ•¸å­—ç½®ä¸­ä½ç§» -38% */}
                                                        <span style={{ transform: 'translateY(-38%)', lineHeight: '1' }}>{num}</span>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>